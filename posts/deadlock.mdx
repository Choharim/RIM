---
title: 교착 상태
description:
createDate: 2022.12.28
tag: 운영체제
---

2개 이상의 프로세스가 다른 프로세스의 작업으로 인해 더이상 진행하지 못하는 상태이다. 한 시스템 내 여러 프로세스가 작업을 하다보니 일어나는 자연스러운 이슈이다.

<aside>
❗ 아사 현상 (무한 봉쇄 현상)  
우선순위에 밀려 프로세스가 실행되지 못하는 무한 대기되는 상태로, 잘못된 CPU 스케줄링에 의한 것이다. (운영체제의 잘못된 정책)

</aside>

## 교착 상태 발생 상황

- 임계 구역으로 보호되는 것처럼 `다른 프로세스와 공유할 수 없는 시스템 자원`을 사용할 때 발생한다.
- `임계 구역을 보호하기 위한 공유 변수에 잠금`처리를 하고 서로의 잠금이 풀리길 기다리며 임계 구역에 들어가지 못하는 상황이다.
- 데이터베이스와 같은 `응용 프로그램에서 데이터의 일관성을 유지하기 위한 잠금`으로 인해 발생한다.

## 교착 상태 필요 조건

다음 필요 조건을 모두 충족했을 때 교착 상태가 발생한다.

### 자원의 특징

`동시에 여러 프로세스가 공유할 수 없고 사용 중일 때 빼앗을 수도 없는 자원`이 사용될 때 교착 상태가 발생할 수 있다.

> 상호 배제

한 프로세스가 사용하는 자원이 임계구역으로 보호되는, 다른 프로세스와 공유할 수 없는 배타적 자원일 때

> 비선점

사용중인 자원을 다른 프로세스가 빼앗을 수 없는 비선점 자원일 때

### 프로세스 간의 행위

`각 프로세스가 점유하고 있는 자원을 서로 기다릴 때` 교착 상태가 발생할 수 있다.

> 점유와 대기

다른 프로세스가 필요로 하는 자원을 점유하고 있으면서 다른 자원을 기다릴 때

> 원형 대기

점유와 대기를 하는 프로세스간의 관계가 원을 이룰 때

<aside>
📌 동시에 여러 프로세스가 공유할 수 없는 배타적 자원이자 사용중에 빼앗을 수 없는 비선점 자원을 각 프로세스가 점유하고 있고 이를 서로 기다리는 상황이면 교착 상태가 발생한다.

</aside>

## 해결 방법

### 예방

교착 상태가 발생하는 필요 조건을 하나라도 충족되지 않게 하여 예방하는 방법이다.

⚠️ 사실상 예방은 사용할 수 없다. 자원을 보호하기 위해 상호 배제와 비선점을 없앨 수 없으며, 점유와 대기 및 원형 대기를 없애려면 한 꺼번에 필요한 자원을 가지던가 아예 자원을 가지지 않던가 해야하는데 이는 자원을 낭비하고 프로세스 작업 방식을 제한하기 때문이다.

### 회피

교착 상태가 발생하지 않는 범위 내에서만 자원을 할당하며 자원 할당량을 조절하여 발생 확률을 줄이는 것이다.

⚠️ 사실상 회피는 실효성이 낮다. 발생 확률이 높다는 이유로 자원 할당을 막음으로 자원이 낭비되고, 자원을 얼마큼 할당해야 교착 상태가 발생하지 않는지 정확하게 알 수 없기 때문이다.

### 검출과 회복

운영체제가 교착 상태가 발생하는지 주시하다 발견되면 이를 해결하는 방식이다. 가장 현실적인 해결 방법이다.

1.  타임 아웃을 이용한 방법  
     일정 시간동안 작업을 진행하지 않는 프로세스를 교착 상태가 발생한 것으로 보는 방법이다.

    - 교착 상태가 아닌 프로세스가 강제 종료되는 문제가 있고, 네트워크로 연결된 데이터베이스에서 네트워크 문제인지 확인할 수 없다.

<aside>
💡 타임아웃으로 데이터베이스가 종료되었을 때 데이터의 일관성을 위해 다음 작업을 한다.

      1. 문제가 발생하면 저장된 상태로 되돌아오기 위한 **체크 포인트로 표시**를 한다.
      2. 체크 포인트를 설정하면 **현재의 데이터(스냅샷 snap shot)를 하드디스크에 저장**한다.
      3. 문제가 발생하여 재실행되면 **롤백**으로 스냅샷을 복원하고 체크 포인트 시점으로 되돌린다.

</aside>
    - 그럼에도 불구하고 많이 선호되는 방법이다. 자원 할당 그래프를 이용한 방법은 구현이 어렵고 모든 자원을 감시하기 어렵기 때문이다.

2.  자원 할당 그래프를 이용한 방법  
    자원 할당 그래프는 프로세스에 어떤 자원이 할당되어 있고 어떤 자원을 기다리는지 프로세스와 자원을 방향 그래프로 나타낸 것이다.  
    ⚠️ 자원 할당 그래프를 유지하기 위해 모든 자원을 감시하기란 한계가 있다.

위와 같은 방법으로 교착 상태가 검출되면 이를 해결하는 회복 작업을 한다.

- 교착 상태를 일으킨 프로세스를 **동시에 종료**한 후 먼저 실행되야 하는 프로세스의 기준을 정해 **순차적으로 실행**하는 방법
- 교착 상태를 일으킨 프로세스 중 우선순위가 낮거나 작업 시간이 짧거나 자원을 많이 사용히는 프로세스를 **순차적으로 종료**하는 방법
