---
title: 프로세스 동기화
description: 프로세스 간 통신에 대해 알아보고, 통신 중 발생하는 동기화 이슈를 어떻게 해결하는 지 알아보자.
createDate: 2022.12.27
tag: 운영체제
---

## 프로세스 간 통신 (IPC - inter process communication)

프로세스는 독립적으로 실행되기도 하고, 서로 통신하며 협업하기도 한다.

### 데이터 통신

- 하나의 프로세스 내에 있는 스레드 간의 통신은 `전역 변수` 또는 `파일` 을 이용한다.
- 같은 컴퓨터 내에 존재하는 프로세스 간 통신은 `파이프` 또는 `공용 파일` 을 이용한다.
- 다른 컴퓨터에 존재하는 프로세스 간 통신은 `소켓` 을 이용한다.

### 종류

> 전역 변수

- 공동으로 관리하는 메모리(Shared Memory)를 이용하여 데이터를 주고(쓰고) 받는(읽는) 방식이다.
- 하나의 변수에 동시에 접근하여 저장할 경우, 오버 라이드되어 나중에 저장한 값으로 덮어진다. 때문에 한쪽 방향으로만 데이터를 전송할 수 있는 **단방향 통신**이다.
- 운영 체제의 동기화 지원이 없는 `대기 없는 비동기화 통신`이다.
  - 언제 데이터가 저장되는지 알 수 없기 때문에 데이터를 읽는 쪽은 데이터를 확인하기 위해 반복적으로 확인하는 `바쁜 대기` 를 사용해야 한다. 이는 시스템 내에서 큰 자원 낭비이다.

<aside>
❓ 동기화  
여러 프로세스가 공동으로 이용하는 메모리와 파일과 같은 `공유 자원`에 접근하여 작업을 완료했을 때 신호를 보내 알려주는 것이다. 해당 자원을 사용하려던 프로세스는 완료 신호를 받을 때 까지 `대기`하게 된다. 같은 자원을 동시에 사용하여 작업을 하게 되면 잘못된 결과가 반환될 수 있기 때문에 동기화는 `자원의 일관성을 유지`을 위해 중요하다.
동기화를 사용하면 바쁜 대기를 사용하지 않아도 운영체제가 알아서 알려준다.

</aside>

> 파일

- 파일에 접근할 수 있는 권한인 파일 기술자(fd, file descriptor)가 있어야 파일을 열고 쓰거나 읽을 수 있다.
  1. open함수로 파일을 열어 fd를 받는다.
  2. fd를 이용해 write함수로 쓰거나 read함수로 읽는다.
  3. 작업을 마치면 close함수로 fd가 가리키는 파일을 닫는다.
- 한쪽으로만 데이터를 전송할 수 있는 **단방향 통신**이다.
- 운영 체제의 도움 없이 진행되는 동기화가 제공되지 않는 `대기 없는 비동기화 통신` 이다. 때문에 wait 시스템 호출을 이용해 동기화를 한다.

> 파이프

- open 함수로 기술자를 얻고 작업을 한 후 close함수로 기술자를 반납하고 마무리한다.
- 한쪽으로만 데이터를 전송할 수 있는 **단방향 통신**이다.
- **운영 체제가 제공**하는 `대기 있는 동기화 통신` 방식이다.  
  프로세스 A가 파이프 1에 읽기를 수행했을 때의 과정은 다음과 같다.
  1. 파이프 1에 해당 데이터가 저장될 때까지 프로세스 A는 대기 상태가 된다.
  2. 데이터가 저장되면 동기화가 이루어진다.
  3. 자동으로 대기 상태가 풀리고 데이터를 받는다.

> 소켓

- 여러 컴퓨터에 있는 프로세스 간에 이루어지는 **네트워킹** 통신이다.
  open 함수로 기술자를 얻고 작업을 한 후 close함수로 기술자를 반납하고 마무리한다.
- 데이터를 동시에 양쪽 방향에서 전송할 수 있는 **양방향 통신**이다.
- **운영 체제가 제공**하는 `대기 있는 동기화 통신` 방식이다.

## 동기화 이슈

여러 프로세스가 하나의 공유 자원을 동시에 작업하는 동안 자원의 일관성이 깨져 프로세스들의 접근하는 순서에 따라 결과가 달라지는 문제이다.

### 경쟁 조건 (race condition)

두 개 이상의 프로세스가 하나의 공유 자원을 병행적으로 읽거나 쓰는 상황을 말한다. 경쟁 조건이 발생하면, 공유 자원 접근 순서에 따라 실행 결과가 달라질 수 있다.

### 임계 구역(critical section)

경쟁 조건이 발생하여 프로세스의 접근 순서에 따라 실행 결과가 달라지는 프로그램의 구간을 말한다.

임계 구역을 가능한 없애는 것이 좋다. 임계 구역이 있다면 여러 프로세스가 동시에 해당 구역에 접근하지 못하도록 임계 구역을 보호해야 한다.

### 임계 구역 해결 방법

1. 한 프로세스가 임계 구역에 들어가면 해당 프로세스가 임계 구역을 나올 때까지 다른 프로세스는 임계 구역에 들어갈 수 없다.
2. 임계 구역의 잠금처리로 인해 프로세스가 임계 구역에 진입하지 못하는 무한 대기를 해서는 안된다.

> 모니터

임계 구역 문제를 해결하는 세마 포어 알고리즘의 원리는 다음과 같다.

1. 임계 구역에 진입하기 전 잠금 처리를 한 후 들어간다.
2. 이후 진입을 원하는 프로세스는 앞의 프로세스가 작업을 마칠 때까지 세마포어 Queue에서 기다린다.
3. 작업을 마쳐서 임계 구역에서 나오게 되면 다음 프로세스에 임계 구역을 사용할 수 있다는 동기화 신호를 보낸다.
4. 신호를 받은 프로세스가 세마포어 Queue에서 나와 임계 구역에 진입한다.

모니터는 세마 포어 알고리즘을 잘못 사용하여 임계 구역이 보호받지 못하는 상황을 막기 위해서 이를 자동으로 대신 처리해주는 알고리즘이다.

1. 임계 구역에 접근을 원하는 프로세스가 모니터에 작업 요청을 한다.
2. 모니터는 해당 프로세스를 모니터 Queue에 저장한 후 순서대로 처리하고, 결과만 해당 프로세스에 알려준다.
